<div class="max-w-5xl mx-auto p-6 space-y-8">
  <header class="flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold text-purple-700">Welcome, {{ driverName }}</h1>
      <p class="text-sm text-gray-500">Driver ID: {{ driverId }}</p>
    </div>
    <nav class="flex gap-4">
      <a class="text-purple-700 hover:text-purple-800 underline" routerLink="/driver/profile">Profile</a>
      <a class="text-purple-700 hover:text-purple-800 underline" routerLink="/driver/ride-requests">Ride Requests</a>
      <a class="text-purple-700 hover:text-purple-800 underline" routerLink="/driver/earnings">Earnings</a>
    </nav>
  </header>

  <!-- Stat cards -->
  <section class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <ng-container *ngIf="(live$ | async) as live">
    <div class="p-4 rounded-lg border border-purple-200 bg-white">
      <p class="text-sm text-gray-500">Today's Rides</p>
      <p class="text-2xl font-semibold text-purple-700">{{ live.today.rides || 0 }}</p>
    </div>
    <div class="p-4 rounded-lg border border-purple-200 bg-white">
      <p class="text-sm text-gray-500">Earnings</p>
      <p class="text-2xl font-semibold text-purple-700">₹{{ live.today.earnings || 0 }}</p>
    </div>
    <div class="p-4 rounded-lg border border-purple-200 bg-white">
      <p class="text-sm text-gray-500">Rating</p>
      <p class="text-2xl font-semibold text-purple-700">{{ stats.today.rating }}</p>
    </div>
    <div class="p-4 rounded-lg border border-purple-200 bg-white">
      <p class="text-sm text-gray-500">Online Time (hrs)</p>
      <p class="text-2xl font-semibold text-purple-700">{{ stats.today.time }}</p>
    </div>
    </ng-container>
  </section>

  <!-- Availability and Break controls -->
  <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="rounded-lg border border-purple-200 bg-white p-4">
      <h2 class="text-lg font-semibold text-purple-700 mb-2">Availability</h2>
      <app-availability-toggle [(isAvailable)]="isOnline"></app-availability-toggle>
      <p class="mt-2 text-sm">Current Status: <strong>{{ isOnline ? 'Online' : 'Offline' }}</strong></p>
    </div>
    <div class="rounded-lg border border-purple-200 bg-white p-4">
      <h2 class="text-lg font-semibold text-purple-700 mb-2">Break Mode</h2>
      <app-break-mode [isOnBreak]="isOnBreak" [breakReason]="breakReason" (BreakMode)="onBreakModeChange($event)"></app-break-mode>
    </div>
  </section>

  <!-- Status logs -->
  <section class="rounded-lg border border-purple-200 bg-white p-4">
    <h2 class="text-lg font-semibold text-purple-700 mb-2">Recent Status</h2>
    <app-status-summary #statusLogger [currentStatus]="currentStatus" [currentTimestamp]="currentTimestamp" [statusLogs]="statusLogs"></app-status-summary>
  </section>

  <!-- Recent Earnings (syncs with Earnings page) -->
  <section class="rounded-lg border border-purple-200 bg-white p-4">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-lg font-semibold text-purple-700">Recent Earnings</h2>
      <a routerLink="/driver/earnings" class="text-sm text-purple-700 underline">View all</a>
    </div>
    <ng-container *ngIf="(earnings$ | async) as earnings">
    <div *ngIf="!earnings.length" class="text-sm text-gray-500 py-4">No earnings yet.</div>
    <ul class="divide-y" *ngIf="earnings.length">
      <li *ngFor="let e of (earnings | slice:0:5)" class="py-3 flex items-center justify-between">
        <div>
          <p class="font-medium">₹{{ e.amount }}
            <span class="ml-3 text-xs px-2 py-1 rounded-full"
              [ngClass]="{
                'bg-green-100 text-green-800': e.paymentMode === 'Cash',
                'bg-indigo-100 text-indigo-800': e.paymentMode === 'UPI',
                'bg-blue-100 text-blue-800': e.paymentMode === 'Card',
                'bg-orange-100 text-orange-800': e.paymentMode === 'Wallet'
              }">
              {{ e.paymentMode }}
            </span>
          </p>
          <p class="text-sm text-gray-600">{{ e.passengerName }} • {{ e.pickupLocation }} → {{ e.dropLocation }}</p>
        </div>
        <div class="text-sm text-gray-500">{{ e.date | date:'short' }}</div>
      </li>
    </ul>
    </ng-container>
  </section>

  <!-- Incoming request (live) -->
  <section *ngIf="incomingRideRequest" class="rounded-lg border border-purple-200 bg-white p-4">
    <h2 class="text-lg font-semibold text-purple-700 mb-2">Incoming Ride Request</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-sm">
      <div><strong>Passenger:</strong> {{ incomingRideRequest.passengerName }}</div>
      <div><strong>Pickup:</strong> {{ incomingRideRequest.pickupLocation }}</div>
      <div><strong>Drop:</strong> {{ incomingRideRequest.dropLocation }}</div>
      <div><strong>Distance:</strong> {{ incomingRideRequest.distance }} km</div>
      <div><strong>Fare:</strong> ₹{{ incomingRideRequest.fare }}</div>
      <div><strong>Requested:</strong> {{ incomingRideRequest.requestedAt | date: 'shortTime' }}</div>
    </div>
    <div class="mt-3 flex gap-3">
      <button class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded" (click)="acceptRequest()">Accept</button>
      <button class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded" (click)="rejectRequest()">Reject</button>
    </div>
  </section>

  
  <section class="rounded-lg border border-purple-200 bg-white p-4">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-lg font-semibold text-purple-700">Recent Ride Requests</h2>
      <a routerLink="/driver/ride-requests" class="text-sm text-purple-700 underline">View all</a>
    </div>
    <ul class="divide-y">
      <li *ngFor="let r of mockRideRequests" class="py-3 flex items-center justify-between">
        <div>
          <p class="font-medium">{{ r.passengerName }}</p>
          <p class="text-sm text-gray-600">{{ r.pickupLocation }} → {{ r.dropLocation }}</p>
        </div>
        <div class="flex items-center gap-3">
          <span class="text-sm text-gray-700">₹{{ r.fare }}</span>
          <button class="px-3 py-1 bg-purple-600 hover:bg-purple-700 text-white rounded" (click)="acceptMockPreview(r)">Accept</button>
          <button class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded" (click)="removeFromPreview(r.id)">Reject</button>
        </div>
      </li>
    </ul>
  </section>
</div>
